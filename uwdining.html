<!DOCTYPE html>
<!header("access-control-allow-origin: *");>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>UW Dining</title>
    <style>
      html, body {
        height: 100%;
        margin: 0px;
        padding: 0px;
      }
      #map-canvas {
      	height: 100%;
      	width: 75%;
      	float: left;
      }
      #sidebar {
      	height: 100%;
      	width: 25%;
      	float: right;
      }
      ul {
      	list-style-type: none;
      }
      li > ul {
      	list-style-type: none;
      	padding: 10px;
      }
      a {
      	color: black;
      }
      a:link {
      	text-decoration: none;
      }
    </style>
    <script src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script src="geoxml3.js"></script>
    <script>
    	function showMap(places){
    		
    		for(var i=0; i<myParser.docs[0].placemarks.length; i++){
				if(myParser.docs[0].placemarks[i].description == places){
					myParser.docs[0].placemarks[i].marker.setVisible(true);
					//console.log(myParser.docs[0].placemarks[i].marker);
				}
				else{
					myParser.docs[0].placemarks[i].marker.setVisible(false);
				}
			};
			
			var listElement = document.getElementById('UW Dining List').childNodes;
			
			for (var i=0;i<listElement.length;i++) {
				if(listElement[i].nodeName == 'LI') {
					if(listElement[i].id == places && document.getElementById(listElement[i].id).childNodes[3].style.display == 'none') {
						document.getElementById(listElement[i].id).childNodes[3].style = "display:block";
					}
					else
						document.getElementById(listElement[i].id).childNodes[3].style = "display:none";
				}
			}
			
    		return false;
    	};
    	
		function useData(docs){
    		myParser.hideDocument(docs[0]);
    		var allPlaces = docs[0].placemarks;
    		    		
    		var listElement = document.getElementById('UW Dining List').childNodes;
    		//console.log(listElement);
    		
    		for (i=0;i<listElement.length;i++) {
    			tempPlace = listElement[i].id;
    			
    			if(listElement[i].nodeName == 'LI'){
    				//console.log(tempPlace);
	    			var placeListUl = document.createElement('ul');
	    			var placeListId = tempPlace + " list"; 
	    			placeListUl.setAttribute("id",placeListId);
	    			var placeList = "";
	    		
	    			for(var j=0;j<allPlaces.length;j++){
	    				placeList += "<li>";
	    				//placeList += '<li>';
	    				if(allPlaces[j].description == tempPlace){
	    					placeList += allPlaces[j].name;
	    					//console.log(allPlaces[j].description);
	    				}
	    				placeList += "</li>";
	    				//placeList += '</li>';
	    			};
	    			
	    			placeListUl.innerHTML = placeList;
	    			document.getElementById(tempPlace).appendChild(placeListUl).style.display = 'none';
    			};
    		};
		};
    	
		function initialize() {
			
  			var uwredsquare = new google.maps.LatLng(47.655878,-122.309507);
  			var mapOptions = {
    			zoom: 12,
    			center: uwredsquare
  			}

  			var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  			myParser = new geoXML3.parser({map: map, afterParse: useData, processStyles: true});
  			myParser.parse('UWDiningMapAutumn2013.kml');
  			
  			//createList();
        };
        	
		google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas">
    </div>
    <div id="sidebar">
    	<ul id="UW Dining List">
    		<li id="Espresso">
    			<a href="#" onclick="showMap(this.parentNode.id)"> Espresso </a>
    		</li>
    		<li id="UW Street Food">
    			 <a href="#" onclick="showMap(this.parentNode.id)"> UW Street Food </a>
    		</li>
    		<li id="Markets">
    			<a href="#" onclick="showMap(this.parentNode.id)"> Markets </a>
    		</li>
    		<li id="Restaurants and Cafes">
    			<a href="#" onclick="showMap(this.parentNode.id)"> Restaurants and Cafes </a>
    		</li>
    		<li id="Pizza">
    			<a href="#" onclick="showMap(this.parentNode.id)"> Pizza </a>
    		</li>
    	</ul>
    </div>
  </body>
</html>